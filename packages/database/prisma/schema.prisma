generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// ============================================
// PROJECTS
// ============================================
model Project {
  id          String    @id @default(cuid())
  name        String
  description String?
  color       String    @default("#808080")
  isFavorite  Boolean   @default(false)
  isArchived  Boolean   @default(false)
  order       Int       @default(0)

  // Week-based timeline (format: "M.W" e.g., "3.1" = March week 1)
  startWeek   String?
  endWeek     String?

  // Link to Area for planning
  areaId      String?
  area        Area?     @relation(fields: [areaId], references: [id], onDelete: SetNull)

  tasks    Task[]
  sections Section[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([isArchived])
  @@index([order])
  @@index([areaId])
}

// ============================================
// SECTIONS (optional grouping within projects)
// ============================================
model Section {
  id    String @id @default(cuid())
  name  String
  order Int    @default(0)

  projectId String
  project   Project @relation(fields: [projectId], references: [id], onDelete: Cascade)
  tasks     Task[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([projectId])
  @@index([order])
}

// ============================================
// TASKS
// ============================================
model Task {
  id          String    @id @default(cuid())
  content     String
  description String?
  priority    Priority  @default(P4)
  isCompleted Boolean   @default(false)
  completedAt DateTime?

  dueDate     DateTime?
  dueDateTime DateTime?

  order Int @default(0)

  projectId String?
  project   Project? @relation(fields: [projectId], references: [id], onDelete: SetNull)

  sectionId String?
  section   Section? @relation(fields: [sectionId], references: [id], onDelete: SetNull)

  // Direct area assignment (for tasks not in a project)
  areaId    String?
  area      Area?    @relation(fields: [areaId], references: [id], onDelete: SetNull)

  labels TaskLabel[]

  parentId String?
  parent   Task?   @relation("Subtasks", fields: [parentId], references: [id], onDelete: Cascade)
  subtasks Task[]  @relation("Subtasks")

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([projectId])
  @@index([sectionId])
  @@index([areaId])
  @@index([isCompleted])
  @@index([dueDate])
  @@index([priority])
  @@index([order])
}

// ============================================
// LABELS
// ============================================
model Label {
  id         String    @id @default(cuid())
  name       String    @unique
  color      String    @default("#808080")
  isFavorite Boolean   @default(false)
  order      Int       @default(0)

  tasks TaskLabel[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([name])
  @@index([order])
}

// ============================================
// TASK-LABEL JUNCTION (Many-to-Many)
// ============================================
model TaskLabel {
  taskId  String
  labelId String

  task  Task  @relation(fields: [taskId], references: [id], onDelete: Cascade)
  label Label @relation(fields: [labelId], references: [id], onDelete: Cascade)

  assignedAt DateTime @default(now())

  @@id([taskId, labelId])
  @@index([taskId])
  @@index([labelId])
}

// ============================================
// AREAS (life categories for planning)
// ============================================
model Area {
  id        String  @id @default(cuid())
  name      String
  icon      String? // emoji or icon name
  color     String  @default("#808080")
  order     Int     @default(0)

  goals    AreaGoal[]
  projects Project[]
  tasks    Task[]    // Direct tasks not in a project

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([order])
}

// ============================================
// AREA GOALS (planning goals per time period)
// ============================================
model AreaGoal {
  id        String @id @default(cuid())
  areaId    String
  area      Area   @relation(fields: [areaId], references: [id], onDelete: Cascade)

  // Time period: "2026-3" for March 2026, "2026-3.2" for week 2 of March 2026
  period    String

  // Goals content (markdown/plain text with Projects and Habits)
  content   String @default("")

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([areaId, period])
  @@index([areaId])
  @@index([period])
}

// ============================================
// PLANNING NOTES (quarterly planning notes with tabs)
// ============================================
model PlanningNote {
  id        String @id @default(cuid())
  title     String @default("New Note")
  content   String @default("")

  // Quarter format: "2026-Q1", "2026-Q2", etc.
  quarter   String
  order     Int    @default(0)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([quarter])
  @@index([order])
}

// ============================================
// ENUMS
// ============================================
enum Priority {
  P1
  P2
  P3
  P4
}
