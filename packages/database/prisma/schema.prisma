generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// ============================================
// PROJECTS
// ============================================
model Project {
  id         String    @id @default(cuid())
  name       String
  color      String    @default("#808080")
  isFavorite Boolean   @default(false)
  isArchived Boolean   @default(false)
  order      Int       @default(0)

  tasks    Task[]
  sections Section[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([isArchived])
  @@index([order])
}

// ============================================
// SECTIONS (optional grouping within projects)
// ============================================
model Section {
  id    String @id @default(cuid())
  name  String
  order Int    @default(0)

  projectId String
  project   Project @relation(fields: [projectId], references: [id], onDelete: Cascade)
  tasks     Task[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([projectId])
  @@index([order])
}

// ============================================
// TASKS
// ============================================
model Task {
  id          String    @id @default(cuid())
  content     String
  description String?
  priority    Priority  @default(P4)
  isCompleted Boolean   @default(false)
  completedAt DateTime?

  dueDate     DateTime?
  dueDateTime DateTime?

  order Int @default(0)

  projectId String?
  project   Project? @relation(fields: [projectId], references: [id], onDelete: SetNull)

  sectionId String?
  section   Section? @relation(fields: [sectionId], references: [id], onDelete: SetNull)

  labels TaskLabel[]

  parentId String?
  parent   Task?   @relation("Subtasks", fields: [parentId], references: [id], onDelete: Cascade)
  subtasks Task[]  @relation("Subtasks")

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([projectId])
  @@index([sectionId])
  @@index([isCompleted])
  @@index([dueDate])
  @@index([priority])
  @@index([order])
}

// ============================================
// LABELS
// ============================================
model Label {
  id         String    @id @default(cuid())
  name       String    @unique
  color      String    @default("#808080")
  isFavorite Boolean   @default(false)
  order      Int       @default(0)

  tasks TaskLabel[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([name])
  @@index([order])
}

// ============================================
// TASK-LABEL JUNCTION (Many-to-Many)
// ============================================
model TaskLabel {
  taskId  String
  labelId String

  task  Task  @relation(fields: [taskId], references: [id], onDelete: Cascade)
  label Label @relation(fields: [labelId], references: [id], onDelete: Cascade)

  assignedAt DateTime @default(now())

  @@id([taskId, labelId])
  @@index([taskId])
  @@index([labelId])
}

// ============================================
// ENUMS
// ============================================
enum Priority {
  P1
  P2
  P3
  P4
}
